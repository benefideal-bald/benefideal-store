# Решение проблемы с удалением базы данных на Render

## Проблема
На Render Free плане файловая система **НЕ полностью персистентна**. База данных может удаляться при деплое, если она находится в неправильном месте.

## Решение

### Текущая конфигурация
1. **База данных в директории `data/`**: База данных теперь создается в `data/subscriptions.db`
2. **Директория `data/` в .gitignore**: Эта директория НЕ коммитится в Git
3. **База данных НЕ в Git**: Это предотвращает перезапись базы данных при деплое

### Как это работает
- При первом запуске на Render создается директория `data/`
- База данных создается в `data/subscriptions.db`
- При следующих деплоях Git клонирует репозиторий, но директория `data/` остается нетронутой
- Все отзывы и заказы сохраняются между деплоями

## Важно

### На Render Free плане
Файлы в рабочей директории **должны** сохраняться между деплоями, НО это **не гарантировано**. Если база данных все равно удаляется:

### Решение 1: Render PostgreSQL (Рекомендуется)
1. Создайте PostgreSQL базу данных на Render (есть бесплатный тир)
2. Измените код для использования PostgreSQL вместо SQLite
3. База данных будет полностью персистентной и надежной

### Решение 2: Railway (Альтернатива)
Railway имеет персистентное хранилище на Free плане:
1. Зайдите на https://railway.app
2. Создайте новый проект
3. Деплойте из GitHub репозитория
4. База данных будет сохраняться автоматически

### Решение 3: Render Disk
Render Disk - это платная функция Render для персистентного хранилища:
1. Создайте Render Disk в панели Render
2. Подключите его к вашему сервису
3. Измените путь базы данных на путь к диску

## Текущая конфигурация

- **Путь базы данных**: `data/subscriptions.db`
- **Директория data/ в .gitignore**: ✅ Да
- **База данных в Git**: ❌ Нет
- **WAL mode**: ✅ Включен
- **Synchronous**: ✅ FULL
- **Автоматический checkpoint**: ✅ После каждой операции

## Проверка после деплоя

1. **Проверьте логи Render**:
   - Откройте панель Render
   - Перейдите в "Logs"
   - Найдите строки:
     - `✅ Created database directory: /opt/render/project/src/data`
     - `✅ Database opened successfully at: /opt/render/project/src/data/subscriptions.db`
     - `✅ Database file exists: true`

2. **Проверьте базу данных**:
   - Откройте сайт
   - Перейдите на страницу отзывов
   - Убедитесь, что все отзывы на месте

3. **Если отзывы все равно пропадают**:
   - Это означает, что на Render Free плане файловая система не персистентна
   - Необходимо перейти на PostgreSQL или Railway

## Рекомендация

Для продакшена **настоятельно рекомендуется** использовать PostgreSQL:
- Полностью персистентная база данных
- Надежное хранилище данных
- Масштабируемость
- Бесплатный тир на Render

