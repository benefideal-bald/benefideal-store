<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –æ–ø–ª–∞—Ç—ã CardLink ‚Äì Benefideal</title>
    <link rel="stylesheet" href="styles.css?v=2.0">
    <style>
        .test-container {
            max-width: 600px;
            margin: 2rem auto;
            padding: 2rem;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .status {
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 8px;
            border-left: 4px solid #ccc;
        }
        .status.success {
            background: #d4edda;
            border-color: #28a745;
        }
        .status.error {
            background: #f8d7da;
            border-color: #dc3545;
        }
        .status.info {
            background: #e7f3ff;
            border-color: #007bff;
        }
        .btn-test {
            width: 100%;
            padding: 1rem;
            font-size: 1.1rem;
            margin-top: 1rem;
        }
        .code-block {
            background: #f5f5f5;
            padding: 1rem;
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.85rem;
            margin-top: 1rem;
            word-break: break-all;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="nav">
                <a href="index.html" class="logo">Benefideal</a>
            </div>
        </div>
    </header>

    <main class="product-page" style="padding: var(--space-24) 0;">
        <div class="test-container">
            <h1 style="margin-bottom: var(--space-6);">üß™ –¢–µ—Å—Ç –æ–ø–ª–∞—Ç—ã CardLink</h1>
            
            <div class="status info">
                <strong>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</strong><br>
                –≠—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–æ–∑–¥–∞—Å—Ç —Ç–µ—Å—Ç–æ–≤—ã–π –ø–ª–∞—Ç–µ–∂ –Ω–∞ —Å—É–º–º—É <strong>10 —Ä—É–±–ª–µ–π</strong>.<br>
                –í—ã —Å–º–æ–∂–µ—Ç–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ø–ª–∞—Ç–µ–∂–∏ —á–µ—Ä–µ–∑ CardLink.
            </div>
            
            <div id="statusContainer"></div>
            
            <button id="testBtn" class="btn btn-primary btn-test" onclick="createTestPayment()">
                –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –ø–ª–∞—Ç–µ–∂
            </button>
            
            <div id="resultContainer" style="margin-top: 2rem;"></div>
        </div>
    </main>

    <script>
        const isLocalhost = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1' || window.location.protocol === 'file:';
        const apiBase = isLocalhost ? 'http://localhost:3000' : window.location.origin;

        async function createTestPayment() {
            const btn = document.getElementById('testBtn');
            const statusContainer = document.getElementById('statusContainer');
            const resultContainer = document.getElementById('resultContainer');
            
            btn.disabled = true;
            btn.textContent = '–°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞...';
            statusContainer.innerHTML = '';
            resultContainer.innerHTML = '';
            
            // –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ (–º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –¥–ª—è CardLink –æ–±—ã—á–Ω–æ 10-100 —Ä—É–±–ª–µ–π)
            const testData = {
                name: '–¢–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å',
                email: 'test@example.com',
                cart: [
                    {
                        id: 1,
                        title: '–¢–µ—Å—Ç–æ–≤—ã–π —Ç–æ–≤–∞—Ä',
                        price: 10, // –ú–∏–Ω–∏–º—É–º 10 —Ä—É–±–ª–µ–π –¥–ª—è CardLink
                        quantity: 1,
                        months: 1
                    }
                ],
                orderId: 'TEST_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9)
            };
            
            statusContainer.innerHTML = `
                <div class="status info">
                    <strong>–°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞...</strong><br>
                    Order ID: ${testData.orderId}<br>
                    –°—É–º–º–∞: 1 —Ä—É–±–ª—å
                </div>
            `;
            
            try {
                const response = await fetch(`${apiBase}/api/cardlink/create-payment`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(testData)
                });
                
                const result = await response.json();
                
                if (result.success && result.payment_url) {
                    statusContainer.innerHTML = `
                        <div class="status success">
                            <strong>‚úÖ –ü–ª–∞—Ç–µ–∂ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!</strong><br>
                            –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –ø—Ä–∏–Ω–∏–º–∞—Ç—å –ø–ª–∞—Ç–µ–∂–∏.
                        </div>
                    `;
                    
                    resultContainer.innerHTML = `
                        <div class="status info">
                            <strong>–î–µ—Ç–∞–ª–∏ –ø–ª–∞—Ç–µ–∂–∞:</strong><br>
                            Order ID: ${testData.orderId}<br>
                            –°—É–º–º–∞: 10 —Ä—É–±–ª–µ–π<br>
                            Email: ${testData.email}
                        </div>
                        <div class="code-block">Payment URL: ${result.payment_url}</div>
                        <div style="margin-top: 1rem;">
                            <a href="${result.payment_url}" target="_blank" class="btn btn-primary" style="display: inline-block; text-decoration: none;">
                                –û—Ç–∫—Ä—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ–ø–ª–∞—Ç—ã
                            </a>
                        </div>
                        <div class="status info" style="margin-top: 1rem;">
                            <strong>–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:</strong><br>
                            1. –û—Ç–∫—Ä–æ–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ–ø–ª–∞—Ç—ã<br>
                            2. –û–ø–ª–∞—Ç–∏—Ç–µ 10 —Ä—É–±–ª–µ–π (—Ç–µ—Å—Ç–æ–≤–∞—è –æ–ø–ª–∞—Ç–∞)<br>
                            3. –ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:<br>
                               - –ó–∞–∫–∞–∑ –ø–æ—è–≤–∏–ª—Å—è –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏<br>
                               - –ü—Ä–∏—à–ª–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram<br>
                               - –í –ª–æ–≥–∞—Ö Railway –µ—Å—Ç—å –∑–∞–ø–∏—Å—å –æ callback<br><br>
                            <strong>–ò–ª–∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Ä–µ–∞–ª—å–Ω—É—é –æ–ø–ª–∞—Ç—É:</strong><br>
                            –ü—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä –≤ –∫–æ—Ä–∑–∏–Ω—É –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∏ –ø—Ä–æ–π–¥–∏—Ç–µ –æ–±—ã—á–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å –æ–ø–ª–∞—Ç—ã —á–µ—Ä–µ–∑ checkout.html
                        </div>
                    `;
                    
                    btn.textContent = '–ü–ª–∞—Ç–µ–∂ —Å–æ–∑–¥–∞–Ω';
                } else if (result.error) {
                    statusContainer.innerHTML = `
                        <div class="status error">
                            <strong>‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞</strong><br>
                            ${result.error}
                        </div>
                    `;
                    
                    resultContainer.innerHTML = `
                        <div class="code-block">${JSON.stringify(result, null, 2)}</div>
                        <div class="status error" style="margin-top: 1rem;">
                            <strong>–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:</strong><br>
                            1. –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞ Railway:<br>
                               - CARDLINK_SHOP_ID<br>
                               - CARDLINK_API_TOKEN<br>
                            2. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ª–∏ –∑–Ω–∞—á–µ–Ω–∏—è –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è<br>
                            3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Railway –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫
                        </div>
                    `;
                    
                    btn.disabled = false;
                    btn.textContent = '–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞';
                } else {
                    statusContainer.innerHTML = `
                        <div class="status error">
                            <strong>‚ùå –ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç</strong>
                        </div>
                    `;
                    
                    resultContainer.innerHTML = `
                        <div class="code-block">${JSON.stringify(result, null, 2)}</div>
                    `;
                    
                    btn.disabled = false;
                    btn.textContent = '–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞';
                }
            } catch (error) {
                statusContainer.innerHTML = `
                    <div class="status error">
                        <strong>‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</strong><br>
                        ${error.message}
                    </div>
                `;
                
                resultContainer.innerHTML = `
                    <div class="status error">
                        <strong>–ü—Ä–æ–±–ª–µ–º–∞:</strong><br>
                        –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É.<br>
                        –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –∏ –¥–æ—Å—Ç—É–ø–µ–Ω.
                    </div>
                `;
                
                btn.disabled = false;
                btn.textContent = '–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞';
            }
        }
    </script>
</body>
</html>
