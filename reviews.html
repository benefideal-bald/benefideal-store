<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Отзывы клиентов - Benefideal</title>
    <link rel="stylesheet" href="styles.css?v=2.9">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        body .review-card {
            width: 100%;
            max-width: 100%;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="nav">
                <a href="index.html" class="logo">Benefideal</a>
                <nav class="nav-links">
                    <a href="index.html">Главная</a>
                    <a href="index.html#subscriptions">Подписки</a>
                    <a href="index.html#about">О нас</a>
                    <a href="index.html#contact">Контакты</a>
                </nav>
                <div class="nav-actions">
                    <button class="cart-toggle" onclick="toggleCart()">
                        <i class="fas fa-shopping-cart"></i>
                        <span class="cart-count" id="cartCount">0</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- All Reviews Page -->
    <main style="padding: 120px var(--space-6) 60px; min-height: 80vh;">
        <div class="section-header" style="max-width: 1280px; margin: 0 auto; text-align: center; margin-bottom: var(--space-10);">
            <h2 class="section-title">Все отзывы наших клиентов</h2>
            <p class="section-subtitle">Отзывы от клиентов Benefideal</p>
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr; gap: var(--space-6);" id="reviewsContainer">
                <!-- All reviews from API will be loaded here (newest first) -->
                <!-- Максим and Тимур are in database with newest dates (today and yesterday) -->
                <!-- They will be first 2 in API response, so they appear first automatically -->
            </div>
            
        <div id="reviewsLoader" style="display: none;"></div>
            
        <div id="loadMoreBtn" style="text-align: center; margin-top: var(--space-12); display: none;">
            <button class="btn btn-secondary" id="showMoreBtn" style="background: var(--white); border: 2px solid var(--primary); color: var(--primary);">
                <i class="fas fa-chevron-down"></i>
                Смотреть больше
            </button>
        </div>
            
        <div style="text-align: center; margin-top: var(--space-16);">
            <a href="index.html" class="btn btn-primary" style="text-decoration: none;">
                <i class="fas fa-arrow-left"></i>
                Вернуться на главную
            </a>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-brand">
                    <h3>Benefideal</h3>
                    <p>Подписки на популярные сервисы по выгодным ценам</p>
                </div>
                <div class="footer-links">
                    <div class="footer-section">
                        <h4>Контакты</h4>
                        <a href="mailto:benefideal@gmail.com" target="_blank" rel="noopener">benefideal@gmail.com</a>
                        <a href="https://t.me/benefiseller" target="_blank" rel="noopener">Telegram</a>
                    </div>
                    <div class="footer-section">
                        <h4>Социальные сети</h4>
                        <a href="https://t.me/clevergramlessons" target="_blank" rel="noopener">Telegram канал</a>
                        <a href="https://www.youtube.com/channel/UCiVvMP4kfZAnCtAgNxS30Ig" target="_blank" rel="noopener">YouTube</a>
                        <a href="https://www.tiktok.com/@benefideal?_t=ZN-90xndH352ak&_r=1" target="_blank" rel="noopener">TikTok</a>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 Benefideal. Все права защищены.</p>
            </div>
        </div>
    </footer>

    <script src="script.js?v=3.8"></script>
    <script>
        // Dynamic loading and pagination for reviews page
        document.addEventListener('DOMContentLoaded', function() {
            const reviewsContainer = document.getElementById('reviewsContainer');
            const loadMoreBtn = document.getElementById('loadMoreBtn');
            const showMoreBtn = document.getElementById('showMoreBtn');
            
            let allReviews = [];
            let displayedCount = 0;
            const reviewsPerPage = 10;
            
            async function loadAllReviews() {
                try {
                    // Determine API URL - try current origin first, then localhost
                    // For all reviews page, sort DESC (newest first, oldest last)
                    let apiUrl;
                    if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1' || window.location.protocol === 'file:') {
                        apiUrl = 'http://localhost:3000/api/reviews?sort=DESC';
                    } else {
                        apiUrl = `${window.location.origin}/api/reviews?sort=DESC`;
                    }
                    
                    const response = await fetch(apiUrl);
                    const data = await response.json();
                    
                    if (data.success && data.reviews && data.reviews.length > 0) {
                        // Use ALL reviews from API (already sorted DESC - newest first)
                        allReviews = data.reviews;
                        console.log('Loaded all reviews:', allReviews.length, 'First (newest):', allReviews[0]?.customer_name, 'Last (oldest):', allReviews[allReviews.length - 1]?.customer_name);
                        // Start from 0 - show first 10 reviews (newest first)
                        displayedCount = 0;
                        displayReviews(); // Will show first 10 reviews (newest first)
                    } else {
                        // No dynamic reviews, but static ones are still visible
                        allReviews = [];
                    }
                } catch (error) {
                    console.error('Error loading reviews:', error);
                    // Keep static reviews even if API fails
                    allReviews = [];
                }
            }
            
            function createReviewCard(review) {
                if (!review || !review.customer_name || !review.review_text) {
                    console.error('Invalid review data:', review);
                    return null;
                }
                
                const card = document.createElement('div');
                card.className = 'review-card';
                
                const rating = review.rating || 5;
                const stars = Array(rating).fill(0).map(() => '<i class="fas fa-star"></i>').join('');
                const emptyStars = Array(5 - rating).fill(0).map(() => '<i class="far fa-star"></i>').join('');
                
                function escapeHtml(text) {
                    const div = document.createElement('div');
                    div.textContent = text;
                    return div.innerHTML;
                }
                
                card.innerHTML = `
                    <div class="review-header">
                        <div class="review-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="review-info">
                            <h4 class="review-name">${escapeHtml(review.customer_name)}</h4>
                            <div class="review-stars">
                                ${stars}${emptyStars}
                            </div>
                        </div>
                    </div>
                    <p class="review-text">${escapeHtml(review.review_text)}</p>
                `;
                
                return card;
            }
            
            function displayReviews() {
                // Display dynamic reviews from displayedCount to displayedCount + reviewsPerPage
                // Dynamic reviews come FIRST (newest first) - Тимур should be at the top!
                const reviewsToShow = allReviews.slice(displayedCount, displayedCount + reviewsPerPage);
                
                if (reviewsToShow.length === 0) {
                    // No more reviews to show
                    loadMoreBtn.style.display = 'none';
                    return;
                }
                
                // Create all cards first
                const cardsToAdd = [];
                    reviewsToShow.forEach(review => {
                        const card = createReviewCard(review);
                        if (card) {
                            card.setAttribute('data-dynamic', 'true');
                            card.classList.add('dynamic-review');
                            cardsToAdd.push(card);
                        } else {
                            console.error('Failed to create review card for:', review);
                        }
                    });
                
                // API returns reviews sorted DESC (newest first)
                // Максим and Тимур are first 2 in API response (newest dates)
                // If first load, remove all existing cards and show first 10 from API
                if (displayedCount === 0) {
                    // Remove all existing cards
                    const existingCards = reviewsContainer.querySelectorAll('.review-card');
                    existingCards.forEach(card => card.remove());
                    
                    // Append first 10 reviews (newest first, Максим and Тимур should be first)
                    cardsToAdd.forEach(card => {
                        reviewsContainer.appendChild(card);
                    });
                } else {
                    // Subsequent loads: append to the end (showing older reviews)
                    cardsToAdd.forEach(card => {
                        reviewsContainer.appendChild(card);
                    });
                }
                
                displayedCount += reviewsToShow.length;
                
                // Show/hide "Load More" button
                if (displayedCount < allReviews.length) {
                    loadMoreBtn.style.display = 'block';
                } else {
                    loadMoreBtn.style.display = 'none';
                }
            }
            
            // Load more button click handler
            showMoreBtn.addEventListener('click', function() {
                displayReviews();
            });
            
            // Initial load - show static reviews immediately, then load dynamic ones
            loadAllReviews();
        });
    </script>
</body>
</html>

