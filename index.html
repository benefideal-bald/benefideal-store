<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate, max-age=0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta http-equiv="Last-Modified" content="0">
    <title>Benefideal - Подписки на популярные сервисы</title>
    <link rel="stylesheet" href="styles.css?v=6.3">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="nav">
                <!-- Гамбургер-меню (только для мобильных) -->
                <button class="mobile-menu-toggle" id="mobileMenuToggle" aria-label="Меню">
                    <i class="fas fa-bars"></i>
                </button>
                
                <!-- Логотип (по центру на мобильных) -->
                <a href="index.html" class="logo">Benefideal</a>
                
                <!-- Навигация (скрыта на мобильных) -->
                <nav class="nav-links" id="navLinks">
                    <a href="#home">Главная</a>
                    <a href="#subscriptions">Товары</a>
                    <a href="#about">О нас</a>
                    <a href="#contact">Контакты</a>
                </nav>
                
                <!-- Корзина -->
                <div class="nav-actions">
                    <button type="button" class="cart-toggle" onclick="return toggleCart(event);">
                        <i class="fas fa-shopping-cart"></i>
                        <span class="cart-count" id="cartCount">0</span>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Мобильное меню (вертикальное) -->
        <div class="mobile-menu" id="mobileMenu">
            <nav class="mobile-nav-links">
                <a href="#home" onclick="closeMobileMenu()">Главная</a>
                <a href="#subscriptions" onclick="closeMobileMenu()">Товары</a>
                <a href="#about" onclick="closeMobileMenu()">О нас</a>
                <a href="#contact" onclick="closeMobileMenu()">Контакты</a>
            </nav>
        </div>
    </header>

    <!-- Promo Banner -->
    <div class="promo-banner">
        <div class="container promo-banner-inner">
            <span class="promo-badge">Новогодняя акция</span>
            <span class="promo-text">
                Скидка <strong>-10%</strong> по промокоду
                <span class="promo-code">2026</span> до <strong>01.02</strong>
            </span>
        </div>
    </div>

    <!-- Hero Section -->
    <section class="hero" id="home">
        <div class="container">
            <div class="hero-content">
                <h1 class="hero-title">Да, вы нашли то что искали...</h1>
                <p class="hero-description">Открывайте доступ к эксклюзивным подпискам и сервисам по самым выгодным ценам. Премиум качество, доступные цены!</p>
                <div class="hero-buttons">
                    <a href="#subscriptions" class="btn btn-primary">
                        Смотреть подписки
                        <i class="fas fa-arrow-right"></i>
                    </a>
                </div>
            </div>
        </div>
    </section>

    <!-- Subscriptions Section -->
    <section class="subscriptions" id="subscriptions">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">Популярные подписки</h2>
                <p class="section-subtitle">Открывайте доступ к эксклюзивным товарам по самым выгодным ценам.</p>
            </div>
            <div class="subscriptions-grid" id="subscriptionsGrid">
                <!-- Products will be loaded here -->
            </div>
        </div>
    </section>

    <!-- Why Choose Us Section -->
    <section class="why-choose-us" id="about">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">Почему выбираете нас?</h2>
            </div>
            <div class="benefits-grid">
                <div class="benefit-card">
                    <div class="benefit-icon">
                        <i class="fas fa-dollar-sign"></i>
                    </div>
                    <h3>Выгодные цены и гарантия качества наших товаров</h3>
                    <p>Мы предлагаем наши товары по отличным ценам.</p>
                </div>
                <div class="benefit-card">
                    <div class="benefit-icon">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <h3>Безопасность и надежность</h3>
                    <p>Мы обеспечиваем безопасность ваших покупок, никаких проблем.</p>
                </div>
                <div class="benefit-card">
                    <div class="benefit-icon">
                        <i class="fas fa-star"></i>
                    </div>
                    <h3>Репутация и доверие</h3>
                    <p>Много клиентов оставили отзывы, и мы дорожим каждым из них.</p>
                </div>
                <div class="benefit-card">
                    <div class="benefit-icon">
                        <i class="fas fa-credit-card"></i>
                    </div>
                    <h3>Удобные способы оплаты</h3>
                    <p>Мы поддерживаем множество вариантов оплаты, доступна оплата в криптовалюте.</p>
                </div>
                <div class="benefit-card">
                    <div class="benefit-icon">
                        <i class="fas fa-headset"></i>
                    </div>
                    <h3>Помощь</h3>
                    <p>Мы всегда на связи. Если нужна помощь по любому вопросу, пишите в поддержку.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- How We Work Section -->
    <section class="how-we-work" id="how-we-work">
        <div class="container">
            <div class="how-we-work-header">
                <h2 class="how-we-work-title">Как мы работаем</h2>
                <p class="how-we-work-subtitle">Простой процесс получения подписки</p>
            </div>
            <div class="workflow">
                <div class="workflow-step">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <h3>Выбор товара</h3>
                        <p>Пользователь просматривает каталог, выбирает интересующий его товар и добавляет его в корзину для последующего оформления заказа.</p>
                    </div>
                </div>
                <div class="workflow-step">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <h3>Оплата</h3>
                        <p>После добавления товаров в корзину клиент переходит к оформлению заказа, выбирает удобный способ оплаты и завершает покупку. Все платежи обрабатываются с соблюдением современных стандартов безопасности.</p>
                    </div>
                </div>
                <div class="workflow-step">
                    <div class="step-number">3</div>
                    <div class="step-content">
                        <h3>Выдача данных</h3>
                        <p>После успешной оплаты клиенту предоставляются необходимые данные. Информация передаётся через электронную почту от минуты до 2 часов после оплаты. (Обратите внимание: если вы берёте подписку на несколько месяцев то данные могут обновляться один раз в месяц, в таком случае новые данные автоматически отправляются на указанную при заказе электронную почту).</p>
                    </div>
                </div>
                <div class="workflow-step">
                    <div class="step-number">4</div>
                    <div class="step-content">
                        <h3>Отзывы</h3>
                        <p>После получения товара клиент может оставить отзыв, чтобы поделиться своим опытом и оценить качество обслуживания. Ваше мнение помогает нам становиться лучше.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Reviews Section -->
    <section class="reviews-section">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">Отзывы наших клиентов</h2>
                <p class="section-subtitle">Что говорят наши последние клиенты о качестве наших услуг</p>
            </div>
            <div class="reviews-grid">
                <div class="reviews-wrapper" id="reviewsWrapper">
                <!-- Все отзывы (статические и динамические) загружаются из JSON через API -->
                </div>
            </div>
            <div style="text-align: center; margin-top: var(--space-8);">
                <a href="reviews.html" class="btn btn-secondary" style="text-decoration: none;">
                    <i class="fas fa-star"></i>
                    Посмотреть все отзывы
                </a>
            </div>
        </div>
    </section>

    <!-- Social Media Section -->
    <section class="social-media">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">Мы в социальных сетях</h2>
            </div>
            <div class="social-links">
                <a href="https://t.me/clevergramlessons" class="social-link telegram" target="_blank">
                    <i class="fab fa-telegram"></i>
                    <span>Telegram канал</span>
                </a>
                <a href="https://www.youtube.com/channel/UCiVvMP4kfZAnCtAgNxS30Ig" class="social-link youtube" target="_blank">
                    <i class="fab fa-youtube"></i>
                    <span>YouTube</span>
                </a>
                <a href="https://www.tiktok.com/@benefideal?_t=ZN-90xndH352ak&_r=1" class="social-link tiktok" target="_blank">
                    <i class="fab fa-tiktok"></i>
                    <span>TikTok</span>
                </a>
            </div>
        </div>
    </section>

    <!-- Contact Section -->
    <section class="contact-simple" id="contact">
        <div class="container">
            <h2 class="contact-title">Свяжитесь с нами</h2>
            <p class="contact-text">Если нужна помощь по любому вопросу, пишите в поддержку.</p>
            <p class="contact-text">Для быстрого ответа рекомендуем писать в Telegram</p>
            <div class="contact-icons">
                <a href="https://t.me/benefiseller" class="contact-icon telegram" target="_blank">
                    <i class="fab fa-telegram"></i>
                </a>
                <a href="mailto:benefideal@gmail.com" class="contact-icon email" target="_blank" rel="noopener">
                    <i class="fas fa-envelope"></i>
                </a>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-brand">
                    <h3>Benefideal</h3>
                    <p>Подписки на популярные сервисы по выгодным ценам</p>
                </div>
                <div class="footer-links">
                    <div class="footer-section">
                        <h4>Контакты</h4>
                        <a href="mailto:benefideal@gmail.com" target="_blank" rel="noopener">benefideal@gmail.com</a>
                        <a href="https://t.me/benefiseller" target="_blank" rel="noopener">Telegram</a>
                    </div>
                    <div class="footer-section">
                        <h4>Социальные сети</h4>
                        <a href="https://t.me/clevergramlessons" target="_blank" rel="noopener">Telegram канал</a>
                        <a href="https://www.youtube.com/channel/UCiVvMP4kfZAnCtAgNxS30Ig" target="_blank" rel="noopener">YouTube</a>
                        <a href="https://www.tiktok.com/@benefideal?_t=ZN-90xndH352ak&_r=1" target="_blank" rel="noopener">TikTok</a>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 Benefideal. Все права защищены.</p>
            </div>
        </div>
    </footer>

    <!-- Cart Modal -->
    <div class="cart-modal" id="cartModal">
        <div class="cart-content">
            <div class="cart-header">
                <h3>Корзина</h3>
                <button class="cart-close" onclick="toggleCart()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="cart-items" id="cartItems">
                <!-- Cart items will be added here -->
            </div>
            <div class="cart-footer">
                <div class="cart-promo">
                    <div class="cart-promo-label">Промокод</div>
                    <div class="cart-promo-row">
                        <input type="text" id="cartPromoCode" class="cart-promo-input" placeholder="Введите промокод">
                        <button type="button" class="cart-promo-apply" onclick="applyCartPromoCode()">
                            Применить
                        </button>
                    </div>
                </div>
                <div class="cart-total">
                    <span>Итого: <span id="cartTotal">0</span> ₽</span>
                </div>
                <button class="btn btn-primary cart-checkout" onclick="checkout()">
                    Перейти к оплате
                </button>
            </div>
        </div>
    </div>

    <!-- Support Chat Widget -->
    <div class="support-chat-widget" id="supportChatWidget">
        <button class="support-chat-toggle" id="supportChatToggle" aria-label="Открыть чат поддержки">
            <i class="fas fa-comments"></i>
            <span class="support-chat-badge" id="supportChatBadge" style="display: none;">1</span>
        </button>
        
        <div class="support-chat-window" id="supportChatWindow">
            <div class="support-chat-header">
                <div class="support-chat-header-info">
                    <i class="fas fa-headset"></i>
                    <div>
                        <h3>Поддержка</h3>
                        <p>Обычно отвечаем в течение минуты</p>
                    </div>
                </div>
                <button class="support-chat-close" id="supportChatClose" aria-label="Закрыть чат">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="support-chat-messages" id="supportChatMessages">
                <div class="support-chat-welcome">
                    <i class="fas fa-robot"></i>
                    <p>Здравствуйте! Чем могу помочь?</p>
                </div>
            </div>
            
            <div class="support-chat-input-area">
                <label class="support-chat-file-label" for="supportChatFileInput">
                    <i class="fas fa-paperclip"></i>
                    <input type="file" id="supportChatFileInput" accept="image/*" style="display: none;">
                </label>
                <input type="text" id="supportChatInput" class="support-chat-input" placeholder="Напишите ваш вопрос..." maxlength="1000">
                <button class="support-chat-send" id="supportChatSend" aria-label="Отправить сообщение">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>

    <script src="script.js?v=4.0"></script>
    <script src="support-chat.js?v=1.0"></script>
    <script>
        // Track page visit (only once per page load)
        (function() {
            // Prevent duplicate calls
            if (window.visitTracked) {
                return;
            }
            window.visitTracked = true;
            
            try {
                const apiUrl = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1' || window.location.protocol === 'file:'
                    ? 'http://localhost:3000/api/track-visit'
                    : `${window.location.origin}/api/track-visit`;
                
                fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        page: window.location.pathname + window.location.search
                    })
                }).catch(err => {
                    // Silently fail - don't interrupt user experience
                    console.log('Visit tracking failed:', err);
                });
            } catch (e) {
                // Silently fail
                console.log('Visit tracking error:', e);
            }
        })();
    </script>
    <script>
        // Мобильное меню - открытие/закрытие
        function toggleMobileMenu() {
            const mobileMenu = document.getElementById('mobileMenu');
            const mobileMenuToggle = document.getElementById('mobileMenuToggle');
            
            if (mobileMenu && mobileMenuToggle) {
                mobileMenu.classList.toggle('active');
                const icon = mobileMenuToggle.querySelector('i');
                if (mobileMenu.classList.contains('active')) {
                    icon.classList.remove('fa-bars');
                    icon.classList.add('fa-times');
                } else {
                    icon.classList.remove('fa-times');
                    icon.classList.add('fa-bars');
                }
            }
        }
        
        function closeMobileMenu() {
            const mobileMenu = document.getElementById('mobileMenu');
            const mobileMenuToggle = document.getElementById('mobileMenuToggle');
            
            if (mobileMenu && mobileMenuToggle) {
                mobileMenu.classList.remove('active');
                const icon = mobileMenuToggle.querySelector('i');
                icon.classList.remove('fa-times');
                icon.classList.add('fa-bars');
            }
        }
        
        // Инициализация мобильного меню
        document.addEventListener('DOMContentLoaded', function() {
            const mobileMenuToggle = document.getElementById('mobileMenuToggle');
            if (mobileMenuToggle) {
                mobileMenuToggle.addEventListener('click', toggleMobileMenu);
            }
            
            // Закрываем меню при клике вне его
            document.addEventListener('click', function(event) {
                const mobileMenu = document.getElementById('mobileMenu');
                const mobileMenuToggle = document.getElementById('mobileMenuToggle');
                
                if (mobileMenu && mobileMenuToggle && 
                    !mobileMenu.contains(event.target) && 
                    !mobileMenuToggle.contains(event.target) &&
                    mobileMenu.classList.contains('active')) {
                    closeMobileMenu();
                }
            });
            
            loadReviews();
        });
        
        // Make loadReviews available globally
        window.loadReviews = async function loadReviews() {
            const reviewsWrapper = document.getElementById('reviewsWrapper');
            if (!reviewsWrapper) {
                console.log('Reviews wrapper not found');
                return;
            }
            
            try {
                // Determine API URL
                let apiUrl;
                if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1' || window.location.protocol === 'file:') {
                    apiUrl = 'http://localhost:3000/api/reviews?limit=10&sort=DESC';
                } else {
                    apiUrl = `${window.location.origin}/api/reviews?limit=10&sort=DESC`;
                }
                
                console.log('Fetching reviews from:', apiUrl);
                const response = await fetch(apiUrl);
                console.log('Response status:', response.status);
                const data = await response.json();
                console.log('API response:', data);
                
                if (data.success && data.reviews && data.reviews.length > 0) {
                    console.log('Loaded', data.reviews.length, 'reviews from API');
                    console.log('First review:', data.reviews[0]?.customer_name, 'created_at:', data.reviews[0]?.created_at);
                    
                    // API returns reviews sorted DESC (newest first)
                    // Максим and Тимур are in database with newest dates (today and yesterday)
                    // They should be first 2 in API response, so we take first 10
                    
                    // Все отзывы (статические и динамические) хранятся вместе в JSON
                    // Удаляем все существующие карточки
                    const existingCards = reviewsWrapper.querySelectorAll('.review-card');
                    existingCards.forEach(card => card.remove());
                    
                    // Берем первые 10 отзывов (уже отсортированы DESC - новые первыми)
                    const reviewsToShow = data.reviews.slice(0, 10);
                    
                    console.log('Displaying', reviewsToShow.length, 'reviews (all from JSON)');
                    
                    // Создаем карточки для всех отзывов
                    const fragment = document.createDocumentFragment();
                    
                    reviewsToShow.forEach((review) => {
                        const card = createReviewCard(review);
                        if (card) {
                            fragment.appendChild(card);
                            console.log('Created card for:', review.customer_name, 'date:', review.created_at);
                        }
                    });
                    
                    // Добавляем все карточки
                    reviewsWrapper.appendChild(fragment);
                    
                    console.log(`✅ Displaying top 10 reviews (newest first):`, reviewsToShow.map(r => r.customer_name));
                    
                    // Reinitialize carousel after loading reviews (DO NOT reorder cards - order is already correct!)
                    reviewsWrapper.style.transform = 'translate3d(0, 0, 0)';
                    setTimeout(() => {
                        if (typeof initReviewsAutoScroll === 'function') {
                            console.log('Reinitializing carousel (preserving order)...');
                            initReviewsAutoScroll();
                        }
                    }, 500);
                } else {
                    console.log('No reviews found in API response');
                    console.log('Response data:', data);
                }
            } catch (error) {
                console.error('Error loading reviews:', error);
                console.error('Error details:', error.message, error.stack);
                // Show error to user in console
                console.warn('⚠️ Не удалось загрузить отзывы из API.');
            }
        };
        
        function createReviewCard(review) {
            if (!review || !review.customer_name || !review.review_text) {
                console.error('Invalid review data:', review);
                return null;
            }
            
            const card = document.createElement('div');
            card.className = 'review-card';
            
            const rating = review.rating || 5;
            const stars = Array(rating).fill(0).map(() => '<i class="fas fa-star"></i>').join('');
            const emptyStars = Array(5 - rating).fill(0).map(() => '<i class="far fa-star"></i>').join('');
            
            card.innerHTML = `
                <div class="review-header">
                    <div class="review-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="review-info">
                        <h4 class="review-name">${escapeHtml(review.customer_name)}</h4>
                        <div class="review-stars">
                            ${stars}${emptyStars}
                        </div>
                    </div>
                </div>
                <p class="review-text">${escapeHtml(review.review_text)}</p>
            `;
            
            return card;
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>
</html>